<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>HtmlWriter.scala</title>
        <script type="text/javascript" src="jquery-all.js"></script>
        <script type="text/javascript" src="linked.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sxr -- Scala X-Ray
 * Copyright 2009, 2010 Mark Harrah, Olivier Michallat
 */</span>

<span class="keyword">package</span> sxr

<span class="keyword">import</span> java.io.File

<span class="keyword">object</span> <a title="object sxr.HtmlWriter" id="9696">HtmlWriter</a>
<span title="ScalaObject" class="delimiter">{</span>
  <span class="comment">/** The location to store the index relative to the output directory.*/</span>
  <span class="keyword">val</span> <a title="java.lang.String" id="55905">IndexRelativePath</a> = <span title="java.lang.String(&quot;index.html&quot;)" class="string">&quot;index.html&quot;</span>
  <span class="comment">/** The location to store the style sheet relative to the output directory.*/</span>
  <span class="keyword">val</span> <a title="java.lang.String" id="55907">CSSRelativePath</a> = <span title="java.lang.String(&quot;style.css&quot;)" class="string">&quot;style.css&quot;</span>
  <span class="comment">/** The location to store the script relative to the output directory.*/</span>
  <span class="keyword">val</span> <a title="java.lang.String" id="55909">JSRelativePath</a> = <span title="java.lang.String(&quot;linked.js&quot;)" class="string">&quot;linked.js&quot;</span>
  <span class="comment">/** The location to store jQuery relative to the output directory.*/</span>
  <span class="keyword">val</span> <a title="java.lang.String" id="55911">JQueryRelativePath</a> = <span title="java.lang.String(&quot;jquery-all.js&quot;)" class="string">&quot;jquery-all.js&quot;</span>

  <span class="keyword">val</span> <a title="java.lang.String" id="55913">HtmlExtension</a> = <span title="java.lang.String(&quot;.html&quot;)" class="string">&quot;.html&quot;</span>

  <span class="comment">/** The path of the default style sheet resource.*/</span>
  <span class="keyword">val</span> <a title="java.lang.String" id="55915">DefaultCSS</a> = <span title="java.lang.String(&quot;/default-style.css&quot;)" class="string">&quot;/default-style.css&quot;</span>
  <span class="comment">/** The path of the default script resource.*/</span>
  <span class="keyword">val</span> <a title="java.lang.String" id="55917">LinkedJS</a> = <span title="java.lang.String(&quot;/linked.js&quot;)" class="string">&quot;/linked.js&quot;</span>
  <span class="comment">/** The path of the JQuery resource.*/</span>
  <span class="keyword">val</span> <a title="java.lang.String" id="55919">LinkedJQuery</a> = <span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#55911" title="=&gt; java.lang.String">JQueryRelativePath</a>

  <span class="comment">/** Copies the default style sheet available as a resource on the classpath to the file 'to'.*/</span>
  <span class="keyword">def</span> <a title="(to: java.io.File)Unit" id="55921">writeDefaultCSS</a><span class="delimiter">(</span><a title="java.io.File" id="55952">to</a>: <span title="java.io.File">File</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="FileUtil.scala.html#9666" title="object sxr.FileUtil">FileUtil</a>.<a href="FileUtil.scala.html#12384" title="(resource: String, to: java.io.File)Unit">writeResource</a><span class="delimiter">(</span><a href="#55915" title="=&gt; java.lang.String">DefaultCSS</a>, <a href="#55952" title="java.io.File">to</a><span class="delimiter">)</span> <span class="delimiter">}</span>
  <span class="comment">/** Copies the default script available as a resource on the classpath to the file 'to'.*/</span>
  <span class="keyword">def</span> <a title="(to: java.io.File)Unit" id="55922">writeJS</a><span class="delimiter">(</span><a title="java.io.File" id="55954">to</a>: <span title="java.io.File">File</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="FileUtil.scala.html#9666" title="object sxr.FileUtil">FileUtil</a>.<a href="FileUtil.scala.html#12384" title="(resource: String, to: java.io.File)Unit">writeResource</a><span class="delimiter">(</span><a href="#55917" title="=&gt; java.lang.String">LinkedJS</a>, <a href="#55954" title="java.io.File">to</a><span class="delimiter">)</span> <span class="delimiter">}</span>
  <span class="comment">/** Copies the jQuery script available as a resource on the classpath to the file 'to'.*/</span>
  <span class="keyword">def</span> <a title="(to: java.io.File)Unit" id="55923">writeJQuery</a><span class="delimiter">(</span><a title="java.io.File" id="55956">to</a>: <span title="java.io.File">File</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="FileUtil.scala.html#9666" title="object sxr.FileUtil">FileUtil</a>.<a href="FileUtil.scala.html#12384" title="(resource: String, to: java.io.File)Unit">writeResource</a><span class="delimiter">(</span><a href="#55919" title="=&gt; java.lang.String">LinkedJQuery</a>, <a href="#55956" title="java.io.File">to</a><span class="delimiter">)</span> <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/** Outputs a set of html files and auxiliary javascript and CSS files that annotate the source
  * code for display in a web browser. */</span>
<span class="keyword">class</span> <a title="class HtmlWriter extends java.lang.Object with sxr.OutputWriter with ScalaObject" id="9695">HtmlWriter</a><a href="#9695" title="ScalaObject" class="delimiter">(</a><a title="sxr.OutputWriterContext" id="55950">context</a>: <a href="OutputWriter.scala.html#9536" title="sxr.OutputWriterContext">OutputWriterContext</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="OutputWriter.scala.html#9716" title="sxr.OutputWriter">OutputWriter</a> <span class="delimiter">{</span>

  <span class="keyword">val</span> <a title="java.io.File" id="55927">outputDirectory</a> = <a href="#55950" title="sxr.OutputWriterContext">context</a>.<a href="OutputWriter.scala.html#40289" title="=&gt; java.io.File">outputDirectory</a>
  <span class="keyword">val</span> <a title="String" id="55929">encoding</a> = <a href="#55950" title="sxr.OutputWriterContext">context</a>.<a href="OutputWriter.scala.html#40291" title="=&gt; String">encoding</a>

  <span class="keyword">import</span> <a href="#9696" title="object sxr.HtmlWriter">HtmlWriter</a>._
  <span class="keyword">val</span> <a title="sxr.OutputInfo" id="55932">info</a> = <span title="sxr.OutputInfo" class="keyword">new</span> <a href="OutputWriter.scala.html#9722" title="sxr.OutputInfo">OutputInfo</a><span class="delimiter">(</span><a href="#55927" title="=&gt; java.io.File">outputDirectory</a>, <a href="#55913" title="=&gt; java.lang.String">HtmlExtension</a><span class="delimiter">)</span>

  <span class="keyword">import</span> <a href="#55932" title="=&gt; sxr.OutputInfo">info</a>._
  <span class="keyword">val</span> <a title="java.io.File" id="55935">cssFile</a> = <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#55927" title="=&gt; java.io.File">outputDirectory</a>, <a href="#55907" title="=&gt; java.lang.String">CSSRelativePath</a><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="java.io.File" id="55937">jsFile</a> = <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#55927" title="=&gt; java.io.File">outputDirectory</a>, <a href="#55909" title="=&gt; java.lang.String">JSRelativePath</a><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="java.io.File" id="55939">jQueryFile</a> = <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#55927" title="=&gt; java.io.File">outputDirectory</a>, <a href="#55911" title="=&gt; java.lang.String">JQueryRelativePath</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">var</span> <a title="List[java.io.File]" id="55942">outputFiles</a> = List<span class="delimiter">[</span>File<span class="delimiter">]</span><span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="()Unit" id="55944">writeStart</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#55921" title="(to: java.io.File)Unit">writeDefaultCSS</a><span class="delimiter">(</span><a href="#55935" title="=&gt; java.io.File">cssFile</a><span class="delimiter">)</span>
    <a href="#55922" title="(to: java.io.File)Unit">writeJS</a><span class="delimiter">(</span><a href="#55937" title="=&gt; java.io.File">jsFile</a><span class="delimiter">)</span>
    <a href="#55923" title="(to: java.io.File)Unit">writeJQuery</a><span class="delimiter">(</span><a href="#55939" title="=&gt; java.io.File">jQueryFile</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(sourceFile: java.io.File, relativeSourcePath: String, tokenList: List[sxr.Token])Unit" id="55945">writeUnit</a><span class="delimiter">(</span><a title="java.io.File" id="55990">sourceFile</a>: <span title="java.io.File">File</span>, <a title="String" id="55991">relativeSourcePath</a>: <span title="String">String</span>, <a title="List[sxr.Token]" id="55992">tokenList</a>: <span title="List[sxr.Token]">List</span><span class="delimiter">[</span>Token<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.io.File" id="56032">outputFile</a> = <a href="OutputWriter.scala.html#55967" title="(relativeSourcePath: String)java.io.File">getOutputFile</a><span class="delimiter">(</span><a href="#55991" title="String">relativeSourcePath</a><span class="delimiter">)</span>
    <a href="#55942" title="(x$1: List[java.io.File])Unit">outputFiles</a> <span title="(x: java.io.File)List[java.io.File]">::=</span> <a href="#56032" title="java.io.File">outputFile</a>
    <span class="keyword">def</span> <a title="(f: java.io.File)String" id="56033">relPath</a><span class="delimiter">(</span><a title="java.io.File" id="56089">f</a>: <span title="java.io.File">File</span><span class="delimiter">)</span> = <a href="FileUtil.scala.html#9666" title="object sxr.FileUtil">FileUtil</a>.<a href="FileUtil.scala.html#12383" title="(fromFile: java.io.File, toFile: java.io.File)String">relativePath</a><span class="delimiter">(</span><a href="#56032" title="java.io.File">outputFile</a>, <a href="#56089" title="java.io.File">f</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="sxr.BasicStyler" id="56034">styler</a> = <span title="sxr.BasicStyler" class="keyword">new</span> <a href="Styler.scala.html#9473" title="sxr.BasicStyler">BasicStyler</a><span class="delimiter">(</span><a href="#55991" title="String">relativeSourcePath</a>, <a href="#56033" title="(f: java.io.File)String">relPath</a><span class="delimiter">(</span><a href="#55935" title="=&gt; java.io.File">cssFile</a><span class="delimiter">)</span>, <a href="#56033" title="(f: java.io.File)String">relPath</a><span class="delimiter">(</span><a href="#55937" title="=&gt; java.io.File">jsFile</a><span class="delimiter">)</span>,  <a href="#56033" title="(f: java.io.File)String">relPath</a><span class="delimiter">(</span><a href="#55939" title="=&gt; java.io.File">jQueryFile</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="Annotate.scala.html#10063" title="(source: java.io.File, sourceEncoding: String, target: java.io.File, tokens: List[sxr.Token], styler: sxr.Styler)Unit">Annotate</a><span class="delimiter">(</span><a href="#55990" title="java.io.File">sourceFile</a>, <a href="#55929" title="=&gt; String">encoding</a>, <a href="#56032" title="java.io.File">outputFile</a>, <a href="#55992" title="List[sxr.Token]">tokenList</a>, <a href="#56034" title="sxr.BasicStyler">styler</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="55946">writeEnd</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.io.File" id="56113">indexFile</a> = <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#55927" title="=&gt; java.io.File">outputDirectory</a>, <a href="#55905" title="=&gt; java.lang.String">IndexRelativePath</a><span class="delimiter">)</span>
    <a href="#55947" title="(to: java.io.File, files: Iterable[java.io.File])Unit">writeIndex</a><span class="delimiter">(</span><a href="#56113" title="java.io.File">indexFile</a>, <a href="#55942" title="=&gt; List[java.io.File]">outputFiles</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">def</span> <a title="(to: java.io.File, files: Iterable[java.io.File])Unit" id="55947">writeIndex</a><span class="delimiter">(</span><a title="java.io.File" id="56118">to</a>: <span title="java.io.File">File</span>, <a title="Iterable[java.io.File]" id="56119">files</a>: <span title="Iterable[java.io.File]">Iterable</span><span class="delimiter">[</span>File<span class="delimiter">]</span><span class="delimiter">)</span>
  <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.io.File" id="56121">relativizeAgainst</a> = <a href="#56118" title="java.io.File">to</a>.<span title="()java.io.File">getParentFile</span>
    <span class="keyword">val</span> <a title="Iterable[String]" id="56122">rawRelativePaths</a> = <a href="#56119" title="Iterable[java.io.File]">files</a>.<span title="(f: java.io.File =&gt; scala.collection.GenTraversableOnce[String])(implicit bf: scala.collection.generic.CanBuildFrom[Iterable[java.io.File],String,Iterable[String]])Iterable[String]">flatMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Iterable.Coll,String,Iterable[String]]" class="delimiter">(</span><a title="java.io.File" id="56140">file</a> =&gt; <a href="FileUtil.scala.html#9666" title="object sxr.FileUtil">FileUtil</a>.<a href="FileUtil.scala.html#12387" title="(baseFile: java.io.File, file: java.io.File)Option[String]">relativize</a><span class="delimiter">(</span><a href="#56121" title="java.io.File">relativizeAgainst</a>, <a href="#56140" title="java.io.File">file</a><span class="delimiter">)</span>.<span title="=&gt; List[String]">toList</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="sxr.wrap.SortedSetWrapper[String]" id="56123">sortedRelativePaths</a> = wrap.<a href="Wrappers.scala.html#9948" title="object sxr.wrap.Wrappers">Wrappers</a>.<a href="Wrappers.scala.html#41803" title="[V &lt;: java.lang.Comparable[V]]=&gt; sxr.wrap.SortedSetWrapper[V]">treeSet</a><span title="sxr.wrap.SortedSetWrapper[String]" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span>
    <a href="#56123" title="sxr.wrap.SortedSetWrapper[String]">sortedRelativePaths</a> <a href="Wrappers.scala.html#41858" title="(all: Iterable[String])Unit">++=</a> <a href="#56122" title="Iterable[String]">rawRelativePaths</a>
    <a href="FileUtil.scala.html#9666" title="object sxr.FileUtil">FileUtil</a>.<a href="FileUtil.scala.html#12374" title="(target: java.io.File)(f: java.io.BufferedWriter =&gt; Unit)Unit">withWriter</a><span class="delimiter">(</span><a href="#56118" title="java.io.File">to</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="java.io.BufferedWriter" id="56172">out</a> =&gt;
      <a href="#56172" title="java.io.BufferedWriter">out</a>.<span title="(x$1: java.lang.String)Unit">write</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=\&quot;Expires\&quot; content=\&quot;0\&quot; /&gt;&lt;/head&gt;&lt;body&gt;&quot;)" class="string">&quot;&quot;&quot;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=&quot;Expires&quot; content=&quot;0&quot; /&gt;&lt;/head&gt;&lt;body&gt;&quot;&quot;&quot;</span><span class="delimiter">)</span>
      <a href="#56123" title="sxr.wrap.SortedSetWrapper[String]">sortedRelativePaths</a>.<a href="Wrappers.scala.html#41835" title="(f: String =&gt; Unit)Unit">foreach</a><span class="delimiter">(</span><a href="#55949" title="(index: java.io.File, out: java.io.Writer)(path: String)Unit">writeEntry</a><a href="#56213" title="String" class="delimiter">(</a><a href="#56118" title="java.io.File">to</a>, <a href="#56172" title="java.io.BufferedWriter">out</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#56172" title="java.io.BufferedWriter">out</a>.<span title="(x$1: java.lang.String)Unit">write</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&lt;/body&gt;&lt;/html&gt;&quot;)" class="string">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  <span class="keyword">import</span> java.io.Writer
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(index: java.io.File, out: java.io.Writer)(path: String)Unit" id="55949">writeEntry</a><span class="delimiter">(</span><a title="java.io.File" id="56208">index</a>: <span title="java.io.File">File</span>, <a title="java.io.Writer" id="56209">out</a>: <span title="java.io.Writer">Writer</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="String" id="56210">path</a>: <span title="String">String</span><span class="delimiter">)</span>
  <span class="delimiter">{</span>
    <a href="#56209" title="java.io.Writer">out</a>.<span title="(x$1: java.lang.String)Unit">write</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&lt;li&gt;&lt;a href=\&quot;&quot;)" class="string">&quot;&lt;li&gt;&lt;a href=\&quot;&quot;</span><span class="delimiter">)</span>
    <a href="#56209" title="java.io.Writer">out</a>.<span title="(x$1: java.lang.String)Unit">write</span><span class="delimiter">(</span><a href="#56210" title="String">path</a><span class="delimiter">)</span>
    <a href="#56209" title="java.io.Writer">out</a>.<span title="(x$1: java.lang.String)Unit">write</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\&quot;&gt;&quot;)" class="string">&quot;\&quot;&gt;&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.lang.String" id="56220">label</a> =
      <span title="java.lang.String" class="keyword">if</span><span class="delimiter">(</span><a href="#56210" title="String">path</a>.<span title="(x$1: java.lang.String)Boolean">endsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;.html&quot;)" class="string">&quot;.html&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#56210" title="String">path</a>.<span title="(x$1: Int, x$2: Int)java.lang.String">substring</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#56210" title="String">path</a>.<span title="()Int">length</span> <span title="(x: Int)Int">-</span> <span title="java.lang.String(&quot;.html&quot;)" class="string">&quot;.html&quot;</span>.<span title="()Int">length</span><span class="delimiter">)</span>
      <span class="keyword">else</span>
        <a href="#56210" title="String">path</a>
    <a href="#56209" title="java.io.Writer">out</a>.<span title="(x$1: java.lang.String)Unit">write</span><span class="delimiter">(</span><a href="#56220" title="java.lang.String">label</a><span class="delimiter">)</span>
    <a href="#56209" title="java.io.Writer">out</a>.<span title="(x$1: java.lang.String)Unit">write</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&lt;/a&gt;&lt;/li&gt;&quot;)" class="string">&quot;&lt;/a&gt;&lt;/li&gt;&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>