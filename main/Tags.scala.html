<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>Tags.scala</title>
        <script type="text/javascript" src="jquery-all.js"></script>
        <script type="text/javascript" src="linked.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sxr -- Scala X-Ray
 * Copyright 2010  Olivier Michallat
 */</span>

<span class="keyword">package</span> sxr.vim

<span class="keyword">import</span> java.io.<span class="delimiter">{</span>BufferedReader, File, PrintWriter<span class="delimiter">}</span>
<span class="keyword">import</span> sxr.<a href="FileUtil.scala.html#9518" title="object sxr.FileUtil">FileUtil</a>.<span class="delimiter">{</span>readLines, withWriter, DefaultEncoding<span class="delimiter">}</span>
<span class="keyword">import</span> sxr.wrap.<span class="delimiter">{</span>Wrappers, SortedSetWrapper<span class="delimiter">}</span>

<span class="keyword">final</span> <span class="keyword">class</span> <a title="class Tag extends java.lang.Object with java.lang.Comparable[sxr.vim.Tag] with NotNull with ScalaObject" id="9611">Tag</a><a href="#9611" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="String" id="64514">name</a>: <span title="String">String</span>, <span class="keyword">val</span> <a title="String" id="64515">file</a>: <span title="String">String</span>, <span class="keyword">val</span> <a title="Int" id="64516">offset</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="java.lang.Comparable[sxr.vim.Tag]">Comparable</span><span class="delimiter">[</span>Tag<span class="delimiter">]</span> <span class="keyword">with</span> <span title="NotNull">NotNull</span> <span class="delimiter">{</span>
  <span class="comment">/** Sort by name and then by file */</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(that: sxr.vim.Tag)Int" id="64506">compareTo</a><span class="delimiter">(</span><a title="sxr.vim.Tag" id="64517">that</a>: <a href="#9611" title="sxr.vim.Tag">Tag</a><span class="delimiter">)</span> = <a href="#9611" title="Tag.this.type" class="keyword">this</a>.<a href="#64514" title="=&gt; String">name</a>.<span title="(x$1: java.lang.String)Int">compareTo</span><span class="delimiter">(</span><a href="#64517" title="sxr.vim.Tag">that</a>.<a href="#64514" title="=&gt; String">name</a><span class="delimiter">)</span> <span title="Int" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="Int" class="int">0</span> =&gt; <a href="#9611" title="Tag.this.type" class="keyword">this</a>.<a href="#64515" title="=&gt; String">file</a>.<span title="(x$1: java.lang.String)Int">compareTo</span><span class="delimiter">(</span><a href="#64517" title="sxr.vim.Tag">that</a>.<a href="#64515" title="=&gt; String">file</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <a title="Int" id="64523">nonzero</a> =&gt; <a href="#64523" title="Int">nonzero</a>
  <span class="delimiter">}</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.lang.String" id="64507">toString</a> = <a href="#64514" title="=&gt; String">name</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\011&quot;)" class="string">&quot;\t&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#64515" title="=&gt; String">file</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\011&quot;)" class="string">&quot;\t&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;:goto &quot;)" class="string">&quot;:goto &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span class="delimiter">(</span><a href="#64516" title="=&gt; Int">offset</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>

  <span class="comment">/** Ensure compareTo is consistent with equals */</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(other: Any)Boolean" id="64508">equals</a><span class="delimiter">(</span><a title="Any" id="64531">other</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#64531" title="Any">other</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a title="Boolean" id="64533">that</a>: <a href="#9611" title="sxr.vim.Tag">Tag</a> =&gt; <a href="#9611" title="Tag.this.type" class="keyword">this</a>.<a href="#64514" title="=&gt; String">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#64533" title="sxr.vim.Tag">that</a>.<a href="#64514" title="=&gt; String">name</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#9611" title="Tag.this.type" class="keyword">this</a>.<a href="#64515" title="=&gt; String">file</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#64533" title="sxr.vim.Tag">that</a>.<a href="#64515" title="=&gt; String">file</a>
    <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
  <span class="delimiter">}</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Int" id="64509">hashCode</a>: <span title="Int">Int</span> = <span title="Int(41)" class="int">41</span> <span title="(x: Int)Int">*</span> <span class="delimiter">(</span> <span title="Int(41)" class="int">41</span> <span title="(x: Int)Int">+</span> <a href="#64514" title="=&gt; String">name</a>.<span title="()Int">hashCode</span><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <a href="#64515" title="=&gt; String">file</a>.<span title="()Int">hashCode</span>
<span class="delimiter">}</span>
<span class="keyword">object</span> <a title="object sxr.vim.Tag" id="9612">Tag</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(n: String, f: String, o: Int)sxr.vim.Tag" id="64559">apply</a><span class="delimiter">(</span><a title="String" id="64561">n</a>: <span title="String">String</span>, <a title="String" id="64562">f</a>: <span title="String">String</span>, <a title="Int" id="64563">o</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <span title="sxr.vim.Tag" class="keyword">new</span> <a href="#9611" title="sxr.vim.Tag">Tag</a><span class="delimiter">(</span><a href="#64561" title="String">n</a>, <a href="#64562" title="String">f</a>, <a href="#64563" title="Int">o</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class TagStore extends java.lang.Object with ScalaObject" id="9614">TagStore</a><a href="#9614" title="ScalaObject" class="delimiter">(</a><a title="java.io.File" id="64577">file</a>: <span title="java.io.File">File</span><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(tags: sxr.wrap.SortedSetWrapper[sxr.vim.Tag])Unit" id="64569">write</a><span class="delimiter">(</span><a title="sxr.wrap.SortedSetWrapper[sxr.vim.Tag]" id="64578">tags</a>: <a href="Wrappers.scala.html#9594" title="sxr.wrap.SortedSetWrapper[sxr.vim.Tag]">SortedSetWrapper</a><span class="delimiter">[</span>Tag<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="FileUtil.scala.html#11946" title="(target: java.io.File)(f: java.io.BufferedWriter =&gt; Unit)Unit">withWriter</a><span class="delimiter">(</span><a href="#64577" title="java.io.File">file</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="java.io.BufferedWriter" id="64585">writer</a> =&gt;
      <a href="#64574" title="(writer: java.io.PrintWriter, tags: sxr.wrap.SortedSetWrapper[sxr.vim.Tag])Unit">write</a><span class="delimiter">(</span><span title="java.io.PrintWriter" class="keyword">new</span> <span title="java.io.PrintWriter">PrintWriter</span><span class="delimiter">(</span><a href="#64585" title="java.io.BufferedWriter">writer</a><span class="delimiter">)</span>, <a href="#64578" title="sxr.wrap.SortedSetWrapper[sxr.vim.Tag]">tags</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  <span class="comment">/** Loads the tags file, ignoring all tags related to a set of source files (passed as
      * absolute paths). */</span>
  <span class="keyword">def</span> <a title="(exclude: Set[String])sxr.wrap.SortedSetWrapper[sxr.vim.Tag]" id="64570">read</a><span class="delimiter">(</span><a title="Set[String]" id="64599">exclude</a>: <span title="Set[String]">Set</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="sxr.wrap.SortedSetWrapper[sxr.vim.Tag]" id="64602">tags</a> = <a href="Wrappers.scala.html#9580" title="object sxr.wrap.Wrappers">Wrappers</a>.<a href="Wrappers.scala.html#44953" title="[V &lt;: java.lang.Comparable[V]]=&gt; sxr.wrap.SortedSetWrapper[V]">treeSet</a><span title="sxr.wrap.SortedSetWrapper[sxr.vim.Tag]" class="delimiter">[</span><a href="#9611" title="sxr.vim.Tag">Tag</a><span class="delimiter">]</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#64577" title="java.io.File">file</a>.<span title="()Boolean">exists</span><span class="delimiter">)</span> <a href="#64571" title="(tags: sxr.wrap.SortedSetWrapper[sxr.vim.Tag], exclude: Set[String])Unit">fillTags</a><span class="delimiter">(</span><a href="#64602" title="sxr.wrap.SortedSetWrapper[sxr.vim.Tag]">tags</a>, <a href="#64599" title="Set[String]">exclude</a><span class="delimiter">)</span>
    <a href="#64602" title="sxr.wrap.SortedSetWrapper[sxr.vim.Tag]">tags</a>
  <span class="delimiter">}</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(tags: sxr.wrap.SortedSetWrapper[sxr.vim.Tag], exclude: Set[String])Unit" id="64571">fillTags</a><span class="delimiter">(</span><a title="sxr.wrap.SortedSetWrapper[sxr.vim.Tag]" id="64603">tags</a>: <a href="Wrappers.scala.html#9594" title="sxr.wrap.SortedSetWrapper[sxr.vim.Tag]">SortedSetWrapper</a><span class="delimiter">[</span>Tag<span class="delimiter">]</span>, <a title="Set[String]" id="64604">exclude</a>: <span title="Set[String]">Set</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="FileUtil.scala.html#11967" title="(file: java.io.File, encoding: String)(f: String =&gt; Unit)Unit">readLines</a><span class="delimiter">(</span><a href="#64577" title="java.io.File">file</a>, <a href="FileUtil.scala.html#11949" title="=&gt; java.lang.String">DefaultEncoding</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="String" id="64614">line</a> =&gt;
      <a href="#64573" title="(s: String)Option[sxr.vim.Tag]">parseTag</a><span class="delimiter">(</span><a href="#64614" title="String">line</a><span class="delimiter">)</span>
        .<span title="(p: sxr.vim.Tag =&gt; Boolean)Option[sxr.vim.Tag]">filter</span><span class="delimiter">(</span><span class="delimiter">{</span><a title="sxr.vim.Tag" id="64619">t</a> =&gt; <span title="=&gt; Boolean">!</span><a href="#64604" title="Set[String]">exclude</a>.<span title="(elem: String)Boolean">contains</span><span class="delimiter">(</span><a href="#64619" title="sxr.vim.Tag">t</a>.<a href="#64515" title="=&gt; String">file</a><span class="delimiter">)</span><span class="delimiter">}</span><span class="delimiter">)</span>
        .<span title="(f: sxr.vim.Tag =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#64603" title="sxr.wrap.SortedSetWrapper[sxr.vim.Tag]">tags</a> <a href="Wrappers.scala.html#45000" title="(t: sxr.vim.Tag)Unit">+=</a> <a href="#64626" title="sxr.vim.Tag">_</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  <span class="keyword">import</span> <a href="#9615" title="object sxr.vim.TagStore">TagStore</a>.<span class="delimiter">{</span>TagDef, Header<span class="delimiter">}</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(s: String)Option[sxr.vim.Tag]" id="64573">parseTag</a><span class="delimiter">(</span><a title="String" id="64615">s</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[sxr.vim.Tag]">Option</span><span class="delimiter">[</span>Tag<span class="delimiter">]</span> = <a href="#64615" title="String">s</a> <span title="()java.lang.String">trim</span> <span title="Option[sxr.vim.Tag]" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="#64633" title="Some[sxr.vim.Tag]">TagDef</a><span class="delimiter">(</span><a title="String" id="64641">n</a>, <a title="String" id="64642">f</a>, <a title="String" id="64643">o</a><span class="delimiter">)</span> =&gt; <span title="(x: sxr.vim.Tag)Some[sxr.vim.Tag]">Some</span><span class="delimiter">(</span><a href="#64559" title="(n: String, f: String, o: Int)sxr.vim.Tag">Tag</a><span class="delimiter">(</span><a href="#64641" title="String">n</a>, <a href="#64642" title="String">f</a>, <a href="#64643" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">o</a>.<span title="=&gt; Int">toInt</span> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#64631" title="None.type">Header</a><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span title="object None">None</span> <span class="comment">// silently ignored</span>
    <span class="keyword">case</span> <span title="None.type">_</span> =&gt; <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Error parsing tag: &quot;)" class="string">&quot;Error parsing tag: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#64615" title="String">s</a><span class="delimiter">)</span> ; <span title="object None">None</span>
  <span class="delimiter">}</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(writer: java.io.PrintWriter, tags: sxr.wrap.SortedSetWrapper[sxr.vim.Tag])Unit" id="64574">write</a><span class="delimiter">(</span><a title="java.io.PrintWriter" id="64590">writer</a>: <span title="java.io.PrintWriter">PrintWriter</span>, <a title="sxr.wrap.SortedSetWrapper[sxr.vim.Tag]" id="64591">tags</a>: <a href="Wrappers.scala.html#9594" title="sxr.wrap.SortedSetWrapper[sxr.vim.Tag]">SortedSetWrapper</a><span class="delimiter">[</span>Tag<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#64590" title="java.io.PrintWriter">writer</a>.<span title="(x$1: java.lang.String)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;!_TAG_FILE_SORTED\0111\011&quot;)" class="string">&quot;!_TAG_FILE_SORTED\t1\t&quot;</span><span class="delimiter">)</span>
    <a href="#64590" title="java.io.PrintWriter">writer</a>.<span title="(x$1: java.lang.String)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;!_TAG_FILE_ENCODING\011&quot;)" class="string">&quot;!_TAG_FILE_ENCODING\t&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="FileUtil.scala.html#11949" title="=&gt; java.lang.String">DefaultEncoding</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\011&quot;)" class="string">&quot;\t&quot;</span><span class="delimiter">)</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><a title="sxr.vim.Tag" id="64670">tag</a> &lt;- <a href="Wrappers.scala.html#44985" title="(f: sxr.vim.Tag =&gt; Unit)Unit">tags</a><span class="delimiter">)</span>
      <a href="#64590" title="java.io.PrintWriter">writer</a>.<span title="(x$1: java.lang.String)Unit">println</span><span class="delimiter">(</span><a href="#64670" title="sxr.vim.Tag">tag</a>.<a href="#64507" title="()java.lang.String">toString</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>
<span class="keyword">object</span> <a title="object sxr.vim.TagStore" id="9615">TagStore</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="64631">Header</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;!_TAG_FILE_.*&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="64633">TagDef</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;(.*)\t(.*)\t:goto (\d+)&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>